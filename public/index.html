<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Motor City - A* Ready</title>
<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0b1220;color:#e6eef8}
#gameContainer{
  width:100vw;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}
#ui{position:absolute;left:10px;top:10px;z-index:20}
button{display:block;margin-bottom:6px;padding:8px 10px;border-radius:6px;border:none;cursor:pointer}
.panel{background:rgba(255,255,255,0.06);padding:10px;border-radius:8px}
/* bottom build bar */
#buildBar{position:absolute;left:50%;transform:translateX(-50%);bottom:10px;z-index:20;display:flex;gap:8px;background:rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px}
#buildBar button{margin:0;padding:8px 10px}
#buildBar .locked{opacity:0.4;pointer-events:none}
/* visualize no-build left area */
#safeOverlay{position:absolute;left:0;top:0;bottom:0;width:260px;background:rgba(255,255,255,0.06);z-index:10;pointer-events:none}
</style>
</head>

<body>
<div id="gameContainer"></div>
<div id="safeOverlay"></div>

<!-- Menú inicial -->
<div id="mainMenu" style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:100;background:rgba(20,20,40,0.95);padding:40px 32px;border-radius:18px;box-shadow:0 0 32px #000;display:flex;flex-direction:column;align-items:center;">
  <h1 style="font-size:2.2em;margin-bottom:24px;color:#ffd54f;text-shadow:2px 2px 8px #222">MotorCity</h1>
  <button id="btnMotorCity" style="font-size:1.2em;margin-bottom:18px;width:220px">Jugar MotorCity</button>
  <button id="btnSimulator" style="font-size:1.2em;margin-bottom:18px;width:220px">Jugar Simulador de Ciudad</button>
  <button id="btnRacing" style="font-size:1.2em;margin-bottom:18px;width:220px">Jugar Racing</button>
  <button id="btnDragRacing" style="font-size:1.2em;width:220px;margin-top:12px;background:#ff4081;color:#fff;">Jugar DragRacing</button>
</div>

<!-- Botón salir -->
<button id="btnSalir" style="position:absolute;top:18px;right:18px;z-index:101;font-size:1.1em;padding:10px 22px;border-radius:10px;background:#263238;color:#ffd54f;border:none;display:none;box-shadow:0 2px 8px #000;">Salir</button>

<!-- Phaser (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>

<!-- Firebase compat (CDN) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script src="src/firebase-config.js"></script>

<script>
// Carga dinámica de modos
const gameContainer = document.getElementById('gameContainer');
const mainMenu = document.getElementById('mainMenu');
const btnMotorCity = document.getElementById('btnMotorCity');
const btnSimulator = document.getElementById('btnSimulator');
const btnRacing = document.getElementById('btnRacing');
btnRacing.onclick = async () => {
  hideMenu();
  currentMode = 'racing';
  await import('./src/racing.js').then(mod => {
    if (mod && mod.startRacingGame) mod.startRacingGame();
  });
};
const btnDragRacing = document.getElementById('btnDragRacing');
btnDragRacing.onclick = async () => {
  hideMenu();
  currentMode = 'dragracing';
  await import('./src/dragracing.js').then(mod => {
    if (mod && mod.startDragRacingGame) mod.startDragRacingGame();
  });
};
const btnSalir = document.getElementById('btnSalir');
let currentMode = null;

function showMenu() {
  mainMenu.style.display = 'flex';
  btnSalir.style.display = 'none';
  gameContainer.innerHTML = '';
  // Limpia cualquier instancia previa
  if (window.MotorCityGame && window.MotorCityGame.destroy) try { window.MotorCityGame.destroy(true); } catch(e) {}
  if (window.MotorCitySim && window.MotorCitySim._game && window.MotorCitySim._game.destroy) try { window.MotorCitySim._game.destroy(true); } catch(e) {}
}

function hideMenu() {
  mainMenu.style.display = 'none';
  btnSalir.style.display = 'block';
}

btnMotorCity.onclick = async () => {
  hideMenu();
  currentMode = 'motorcity';
  // Carga el modo MotorCity
  await import('./src/motorcity/game.js').then(mod => {
    if (mod && mod.startMotorCityGame) mod.startMotorCityGame();
  });
};

btnSimulator.onclick = async () => {
  hideMenu();
  currentMode = 'simulator';
  // Carga el modo Simulador
  await import('./src/simulator/game.js').then(mod => {
    if (mod && mod.startSimulatorGame) mod.startSimulatorGame();
  });
};

btnSalir.onclick = () => {
  showMenu();
  currentMode = null;
};

// Mostrar menú al inicio
showMenu();
</script>
</body>
</html>